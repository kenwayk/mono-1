<script type="application/javascript">
    const user = JSON.parse('<%- JSON.stringify(user) %>');
    const monoData = JSON.parse('<%- JSON.stringify(mono) %>');

    // console.log(user._id);
    // console.log(monoData);

    const copyToClipboard = text => {
        const elm = document.createElement('textarea');
        elm.value = text;
        document.body.appendChild(elm);
        elm.select();
        document.execCommand('copy');
        document.body.removeChild(elm);
    };
    var connect;
    var config = {
        key: monoData.publicKey,
        onSuccess: function (response) {
            // alert(response.code)
        // copyToClipboard(response.code);

            // Store code in db, with User ID.
            (async function() {

                const res = await fetch('/dashboard', { 
                    method: 'POST', 
                    body: JSON.stringify({ code: response.code, id: user._id }),
                    headers: {'Content-Type': 'application/json'}
                }).then(res_ => res_.json())
                    .then(function (res_) {
                        //   const data = await res.json();
                        console.log(res_);
                        // if (data.user) {
                        location.assign('/dashboard');
                        // }
                    });

            })();


        },
        onClose: function () {
        console.log('user closed the widget.')
        }
    };
    connect = new Connect(config);
    connect.setup();
    var launch = document.getElementById('launch-btn');
    launch.onclick = function (e) {
        connect.open();
    };
</script>